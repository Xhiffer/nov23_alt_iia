{% extends "base.html" %}
{% block content %}

<div>
    <div id="resultatAiTable"></div>
</div>

<script>
window.addEventListener("DOMContentLoaded", () => {

    const table = new Tabulator("#resultatAiTable", {
        height: "50vh",
        layout: "fitColumns",
        ajaxURL: "/ajax/resultats_ai",  // your Flask route
        progressiveLoad: "scroll",
        paginationSize: 10,
        placeholder: "No data available",
        columns: [
            { title: "ID", field: "id", width: 70 },
            { title: "Nombre Véhicules", field: "nombre_vehicules" },
            { title: "Vitesse Estimée", field: "vitesse_estimee" },
            { title: "Impact Détecté", field: "impact_detecte" },
            { title: "Conditions Météo", field: "conditions_meteo" },
            { title: "Présence Piétons", field: "presence_pietons" },
            { title: "Type de Route", field: "type_route" },
            { title: "Gravité Estimée", field: "gravite_tag.label", titleDownload: "Gravité" },
        ],
        ajaxResponse: function(url, params, response){
            console.log("Data loaded:", response.data);
            return response;
        }
    });

    // ✅ Attach row double click with Tabulator's event binding
    table.on("rowDblClick", function(e, row) {
        console.log("Double-click detected!", row.getData());
        const id = row.getData().id;
        window.location.href = `/alert?id=${id}`;
    });

    // ✅ Debugging click to confirm interaction works
    table.on("rowClick", function(e, row) {
        console.log("Row clicked", row.getData());
    });

});
</script>

{% endblock %}
